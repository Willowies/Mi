<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mi.model.dao.ServiceNetworkDAO">
    
    <select id="selectSN"  resultMap="ServiceNetworkMap">
        select SN.*,SP.*,ST.*
        from ServiceNetwork SN,productSecondClass SP,ServiceType ST,
             NetworkServiceConnection NTC,NetworkProductConnection NPC
             
        where 
        SN.snId=NTC.snId
        and
        ST.stId=NTC.stId
        
        and
        SN.snId=NPC.snId
        and
        SP.SecondClassId=NPC.SecondClassId
        
        and 
        SN.snId in 
        (select SN.snId 
        from 
        ServiceNetwork SN,productSecondClass SP,ServiceType ST,
        NetworkServiceConnection NTC,NetworkProductConnection NPC
        where 
        SN.snCity=#{0}
       
      
        <if test="#{1}!=null and #{1}!=' ' ">
          and 
          SP.SecondClassId=#{1}
          and
          SN.snId=NPC.snId
          and
          SP.SecondClassId=NPC.SecondClassId  
        </if>
         )  
    </select>
    <select id="selectAllServiceProducts" resultType="ServiceProduct">
    select * from productSecondClass
    </select>
    
    <resultMap type="ServiceNetwork" id="ServiceNetworkMap">
    <id property="snId" column="snId"/>
    <result property="snName" column="snName"/>
    <result property="snCity" column="snCity"/>
    <result property="snCountry" column="snCountry"/>
    <result property="snAddress" column="snAddress"/>
    <result property="snTelephone" column="snTelephone"/>
    <result property="snWorkTime" column="snWorkTime"/>
    <collection property="ServiceProducts" ofType="ServiceProduct">
        <id property="spId" column="SecondClassId"/>
        <result property="spName" column="SecondClassName"/>
    </collection>
    <collection property="ServiceTypes" ofType="ServiceType">
       <id property="stId" column="stId"/>
       <result property="stName" column="stName"/>
    </collection>
    
    </resultMap>

</mapper>